<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> JJ Furniture - Part 1 - Julian Swart </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="" />
    <meta property="og:site_name" content="Julian Swart" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://julian-swart.github.io/blog/jj_furniture_part1/" />
    <meta property="og:title" content="JJ Furniture - Part 1" />
    <meta property="og:image" content="https://julian-swart.github.io" />
    <meta property="og:description" content="" />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:title" content="JJ Furniture - Part 1" />
    <meta name="twitter:description" content="" />
    <meta name="twitter:image" content="https://julian-swart.github.io" />

    <link rel="canonical" href="https://julian-swart.github.io/blog/jj_furniture_part1/">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous" />

    <link rel="stylesheet" href="https://julian-swart.github.io/css/custom.css" />

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css" integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin="anonymous" />
    

    

    <link rel="shortcut icon"
        href="https://julian-swart.github.io/images/wave.jpeg">

    
    <link href="https://julian-swart.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Julian Swart" />
    
</head>

<body>
    
<div class="mt-xl header">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-auto">
                <a href="https://julian-swart.github.io">
                    <h1 class="name">Julian Swart</h1>
                </a>
                <span style="font-weight:300; color:#738491;"><center>Data Scientist</center></span>
            </div>
        </div></br>

        <div class="row justify-content-center">
            <ul class="nav nav-primary">
                
                <li class="nav-item">
                    <a class="nav-link" href="https://julian-swart.github.io/">
                        
                        Home
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="https://julian-swart.github.io/about/">
                        
                        About
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/julian-swart">
                        
                        GitHub
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="https://www.linkedin.com/in/julian-swart9">
                        
                        LinkedIn
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>


<div class="content">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-12 col-lg-8">
                <br>
                <br>
                <h1 class="meta-blog-title">JJ Furniture - Part 1</h1>

                <div class="ml-0 meta">
                    
                    
                    <span class="author" title="Julian Swart">
                        Julian Swart
                    </span>
                    
                    

                    <span class="date middot" title='Mon Dec 26 2022 00:00:00 UTC'>
                        Dec 2022
                    </span>

                    <span class="reading-time middot">
                        10 min read
                    </span>

                    <div class="d-none d-md-inline tags">
                        <ul class="list-unstyled d-inline">
                            
                        </ul>
                    </div>
                </div>
                <br>
                <aside>
                    <nav id="TableOfContents"></nav>
                </aside>
                <br>
                <div class="markdown blog-post-content">
                    <script defer language="javascript" type="text/javascript"  src="https://julian-swart.github.io/js/custom.js"></script>
  
    <br>
<div class="meta-blog-subheader">
Table of Contents
</div>
<blockquote>
<p><a href="#intro">Intro</a><br>
<a href="#arch">Data Model</a><br>
<a href="#aws">AWS</a><br>
<a href="#scripts">Scripts</a><br>
<a href="#result">Results</a><br>
<a href="#learned">What was Learned</a></p>
</blockquote>
<br>
<p><font color="grey"> This post was in collaboration with <a href="https://linkedin.com/in/jonathan-adams-tn" title="Click to see his LinkedIn">Jonathan Adams.</a> </font></p>
<br>
<!-- #region Intro -->
<div class="meta-blog-header">
Intro <a name="intro"></a>
</div>
<br>
<p>Instead of using a common online dataset, a colleague and I decided to simulate what a real company&rsquo;s data looks like. This way, we could learn more about data engineering and use a data structure that we were familiar with. We called the fake company JJ Furnitiure (JJ stands for Julian and Jon) and created artifical transaction, customer, and product data.</p>
<p>This project stemmed from wanting to deepen our understanding of the entire data process and needing to showcase some of our capabilities to the public. This post, Part 1, is about data engineering and our learnings. Part 2 will be data science oriented.</p>
<!-- #endregion -->
<br>
<br>
<!-- #region Data Model -->
<div class="meta-blog-header">
Data Model <a name="arch"></a>
</div>
<br>
<p>The big thing we learned was data engineers use two types of databases to accomplish the below tasks:</p>
<ul>
<li>loading in raw data from source systems (OLTP: writing data | recording system | AWS RDS)</li>
<li>designing tables that benefit end-users (OLAP: reading data | analytical system | AWS Redshift)</li>
</ul>
<p>We discovered that the below image is a common data model that teams follow. They load in their raw transactional data into an OLTP type system. This type is best for writing data - things like insert, update, and delete. The next part is ETL (extract, transform, load). Here, you design a star schema and load in the results to an OLAP database. This type is best for reading data, aka SQL queries. End-users who do analytics and make dashboards benefit from this system.</p>
<br>
<div class="figure">
<p><img src="https://julian-swart.github.io/images/oltp_etl_olap.png" alt=""></p>
<p class="caption">Typical cycle of data processing for a business </a></p>
</div>
<br>
<br>
<p>For our project, we wanted to create raw source data that somewhat imitated reality. This type of data is usually messy and needs wrangling. We also tried to design it how real data engineers would. Generally, this consists of having small tables that you would later join on in an ETL process. This enables the engineer to more easily keep track of and manipulate tables. The below image is the OLTP system we designed.</p>
<div class="figure">
<p><img src="https://julian-swart.github.io/images/erd_raw.png" alt=""></p>
<p class="caption">ERD: Entity Relationship Diagram of our OLTP database </a></p>
</div>
<!-- #endregion -->
<br>
<br>
<br>
<br>
<!-- #region AWS -->
<div class="meta-blog-header">
AWS <a name="aws"></a>
</div>
<br>
<p>Following our above data model, we first needed to create an OLTP type structure for our transactional database. Since businesses create data through transactions, we need a place to store this data. The purpose of this database is for writing data, not reading. End-users should never see this database.</p>
<p>We decided to use Amazon Web Services free tier to accomplish this. The OLTP model in AWS is called RDS (relational database service). This uses row-rise storage because apparently it&rsquo;s the most efficient for writing data. The OLAP model in AWS is the familiar Redshift (we didn&rsquo;t do this for our project). Redshfit stores data column-wise. For whatever reason that makes it process queries faster.</p>
<p>To get started, we made an AWS root-user account and went to the Amazon service called RDS and clicked &ldquo;Create database&rdquo;.</p>
<br>
<br>
<div class="figure">
<p><img src="https://julian-swart.github.io/images/aws_signin.jpeg" alt=""></p>
<p class="caption">AWS Sign-in page </a></p>
</div>
<br>
<br>
<br>
<div class="figure">
<p><img src="https://julian-swart.github.io/images/aws_create_db.png" alt=""></p>
<p class="caption">Amazon RDS page for creating our OLTP database </a></p>
</div>
<br>
<br>
<br>
<p>After going through the steps to make the RDS on Amazon&rsquo;s website, we then needed a SQL client to connect to it. We chose to use the common SQL langauge called <code>postgres</code> when we created our RDS. DBeaver is a good SQL client for Mac&rsquo;s, so we used that.</p>
<p>Of course there were errors when we tried to connect to the database. Thankfully, others had encountered these hurdles before and made good posts online on how to overcome them. Main issues were:</p>
<ul>
<li>&ldquo;Connection timeout&rdquo; error. Solution: make a security group with Amazon EC2. This was not an intuitive design by Amazon.</li>
<li>Our database name didn&rsquo;t work for the connection. Solution: use the default name &ldquo;postgres&rdquo;, not what you named your database on the Amazon RDS website&hellip;geez.</li>
</ul>
<br>
<p>Here are screenshots of the solutions we found online that saved us:</p>
<br>
<div class="figure">
<p><img src="https://julian-swart.github.io/images/aws_issue1.png" alt=""></p>
<p class="caption">Database connection hurdle #1 </a></p>
</div>
<br>
<br>
<br>
<br>
<div class="figure">
<p><img src="https://julian-swart.github.io/images/aws_issue2.png" alt=""></p>
<p class="caption">Database connection hurdle #2 </a></p>
</div>
<br>
<br>
<br>
<br>
<p>Thanks to the above two posts, we connected to the database. It was with much gratitude that we could then turn our attention to more fun stuff, like writing some <code>python</code> code that would simulate our fake furniture company&rsquo;s data and insert it into RDS tables.</p>
<!-- #endregion -->
<br>
<br>
<br>
<br>
<!-- #region Scripts -->
<div class="meta-blog-header">
Scripts <a name="scripts"></a>
</div>
<br>
<div class="meta-blog-subheader">
1) Postgres connector
</div>
<br>
<!-- #region postgres connector python code -->
<div class="highlight-wrapper">
    <div class="highlight-before">python</div>
    
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">psycopg2</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">configparser</span> <span class="kn">import</span> <span class="n">ConfigParser</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PostgresConnector</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#39;&#39;Used for creating connection to MySQL database.
</span></span></span><span class="line"><span class="cl"><span class="s1">    Has methods for pulling data and performing database
</span></span></span><span class="line"><span class="cl"><span class="s1">    updates&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file_path</span><span class="o">=</span><span class="s1">&#39;config.ini&#39;</span><span class="p">,</span> <span class="n">section</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-16&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;&#39;&#39;Initialize connection to MySQL database.
</span></span></span><span class="line"><span class="cl"><span class="s1">        This requires a config file with named section
</span></span></span><span class="line"><span class="cl"><span class="s1">        containing the following fields:
</span></span></span><span class="line"><span class="cl"><span class="s1">        HOST, PORT, USER, PASSWORD, DATABASE&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cf</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">config_file_path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">db_host</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;HOST&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">db_port</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;PORT&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">db_user</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;USER&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">db_pwd</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="s1">&#39;PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">db_name</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span><span class="s1">&#39;DATABASE&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_connect</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db_host</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                        <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_port</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                                        <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db_user</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                        <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db_pwd</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                        <span class="n">dbname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">queryall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;&#39;&#39;Executes SQL query and returns the fetched dataset&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connect</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> \
</span></span><span class="line"><span class="cl">                       <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">))]</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">finally</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">return_df</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;&#39;&#39;Executes SQL queries used for updating database
</span></span></span><span class="line"><span class="cl"><span class="s1">        such as insert and update (CRUD operations)&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connect</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_connect</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">finally</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;&#39;&#39;Close connection to MySQL database&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connect</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_connect</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></span></span></code></pre></div>
    
</div>
<!-- #endregion -->
<br> 
<br>
<br> 
<div class="meta-blog-subheader">
2) SQL queries
</div>
<br>
<!-- #region SQL queries script python code -->
<div class="highlight-wrapper">
    <div class="highlight-before">python</div>
    
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1"># DROP TABLES</span>
</span></span><span class="line"><span class="cl"><span class="n">drop_customer_table</span> <span class="o">=</span> <span class="s2">&#34;DROP TABLE IF EXISTS customers&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">drop_product_table</span> <span class="o">=</span> <span class="s2">&#34;DROP TABLE IF EXISTS products&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">drop_material_table</span> <span class="o">=</span> <span class="s2">&#34;DROP TABLE IF EXISTS materials&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">drop_color_table</span> <span class="o">=</span> <span class="s2">&#34;DROP TABLE IF EXISTS colors&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">drop_description_table</span> <span class="o">=</span> <span class="s2">&#34;DROP TABLE IF EXISTS desription&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">drop_transactions_table</span> <span class="o">=</span> <span class="s2">&#34;DROP TABLE IF EXISTS transactions&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># CREATE TABLES</span>
</span></span><span class="line"><span class="cl"><span class="n">create_customer_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">CREATE TABLE IF NOT EXISTS customers
</span></span></span><span class="line"><span class="cl"><span class="s2">(
</span></span></span><span class="line"><span class="cl"><span class="s2">     customer_id    SERIAL PRIMARY KEY,
</span></span></span><span class="line"><span class="cl"><span class="s2">     first_name     VARCHAR(200),
</span></span></span><span class="line"><span class="cl"><span class="s2">     last_name      VARCHAR(200),
</span></span></span><span class="line"><span class="cl"><span class="s2">     email_address  VARCHAR(200),
</span></span></span><span class="line"><span class="cl"><span class="s2">     dob            DATE,
</span></span></span><span class="line"><span class="cl"><span class="s2">     gender         VARCHAR(100),
</span></span></span><span class="line"><span class="cl"><span class="s2">     street_address VARCHAR(1000),
</span></span></span><span class="line"><span class="cl"><span class="s2">     state          VARCHAR(20),
</span></span></span><span class="line"><span class="cl"><span class="s2">     date_created   DATE,
</span></span></span><span class="line"><span class="cl"><span class="s2">     create_source  VARCHAR(100)
</span></span></span><span class="line"><span class="cl"><span class="s2"> )
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create_product_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">CREATE TABLE IF NOT EXISTS products
</span></span></span><span class="line"><span class="cl"><span class="s2">(
</span></span></span><span class="line"><span class="cl"><span class="s2">     product_id       SERIAL PRIMARY KEY,
</span></span></span><span class="line"><span class="cl"><span class="s2">     material_id      INT,
</span></span></span><span class="line"><span class="cl"><span class="s2">     color_id         INT,
</span></span></span><span class="line"><span class="cl"><span class="s2">     description_id   INT,
</span></span></span><span class="line"><span class="cl"><span class="s2">     pieces           INT,
</span></span></span><span class="line"><span class="cl"><span class="s2">     cost             NUMERIC
</span></span></span><span class="line"><span class="cl"><span class="s2"> )
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create_material_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">CREATE TABLE IF NOT EXISTS materials
</span></span></span><span class="line"><span class="cl"><span class="s2">(
</span></span></span><span class="line"><span class="cl"><span class="s2">     material_id      SERIAL PRIMARY KEY,
</span></span></span><span class="line"><span class="cl"><span class="s2">     material_desc    VARCHAR(1000)
</span></span></span><span class="line"><span class="cl"><span class="s2"> )
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create_color_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">CREATE TABLE IF NOT EXISTS colors
</span></span></span><span class="line"><span class="cl"><span class="s2">(
</span></span></span><span class="line"><span class="cl"><span class="s2">     color_id       SERIAL PRIMARY KEY,
</span></span></span><span class="line"><span class="cl"><span class="s2">     color_desc     VARCHAR(1000)
</span></span></span><span class="line"><span class="cl"><span class="s2"> )
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create_description_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">CREATE TABLE IF NOT EXISTS descriptions
</span></span></span><span class="line"><span class="cl"><span class="s2">(
</span></span></span><span class="line"><span class="cl"><span class="s2">     description_id          SERIAL PRIMARY KEY,
</span></span></span><span class="line"><span class="cl"><span class="s2">     product_description     VARCHAR(1000)
</span></span></span><span class="line"><span class="cl"><span class="s2"> )
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create_transactions_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">CREATE TABLE IF NOT EXISTS transactions
</span></span></span><span class="line"><span class="cl"><span class="s2">(
</span></span></span><span class="line"><span class="cl"><span class="s2">     id                  SERIAL PRIMARY KEY,
</span></span></span><span class="line"><span class="cl"><span class="s2">     transaction_id          INT,
</span></span></span><span class="line"><span class="cl"><span class="s2">     transaction_date        DATE,
</span></span></span><span class="line"><span class="cl"><span class="s2">     customer_id             INT,
</span></span></span><span class="line"><span class="cl"><span class="s2">     product_id              INT,
</span></span></span><span class="line"><span class="cl"><span class="s2">     line_item_number        SMALLINT,
</span></span></span><span class="line"><span class="cl"><span class="s2">     sale_amount             NUMERIC(20),
</span></span></span><span class="line"><span class="cl"><span class="s2">     quantity                SMALLINT,
</span></span></span><span class="line"><span class="cl"><span class="s2">     sale_or_return          INT
</span></span></span><span class="line"><span class="cl"><span class="s2"> )
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># INSERT QUERIES</span>
</span></span><span class="line"><span class="cl"><span class="n">insert_customer_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">INSERT INTO customers (first_name, last_name, email_address,
</span></span></span><span class="line"><span class="cl"><span class="s2">dob, gender, street_address, state, date_created, create_source)
</span></span></span><span class="line"><span class="cl"><span class="s2">VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">insert_product_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">INSERT INTO products (material_id, color_id, description_id, pieces, cost)
</span></span></span><span class="line"><span class="cl"><span class="s2">VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">insert_material_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">INSERT INTO materials (material_desc)
</span></span></span><span class="line"><span class="cl"><span class="s2">VALUES (</span><span class="si">%s</span><span class="s2">)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">insert_color_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">INSERT INTO colors (color_desc)
</span></span></span><span class="line"><span class="cl"><span class="s2">VALUES (</span><span class="si">%s</span><span class="s2">)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">insert_description_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">INSERT INTO descriptions (product_description)
</span></span></span><span class="line"><span class="cl"><span class="s2">VALUES (</span><span class="si">%s</span><span class="s2">)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">insert_transactions_table</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">INSERT INTO transactions (transaction_id, transaction_date, customer_id, product_id, line_item_number, sale_amount, quantity, sale_or_return)
</span></span></span><span class="line"><span class="cl"><span class="s2">VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># QUERY LISTS</span>
</span></span><span class="line"><span class="cl"><span class="n">drop_table_queries</span> <span class="o">=</span> <span class="p">[</span><span class="n">drop_customer_table</span><span class="p">,</span> <span class="n">drop_product_table</span><span class="p">,</span> <span class="n">drop_material_table</span><span class="p">,</span> <span class="n">drop_color_table</span><span class="p">,</span> <span class="n">drop_description_table</span><span class="p">,</span> <span class="n">drop_transactions_table</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">create_table_queries</span> <span class="o">=</span> <span class="p">[</span><span class="n">create_customer_table</span><span class="p">,</span> <span class="n">create_product_table</span><span class="p">,</span> <span class="n">create_material_table</span><span class="p">,</span> <span class="n">create_color_table</span><span class="p">,</span> <span class="n">create_description_table</span><span class="p">,</span> <span class="n">create_transactions_table</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">insert_table_queries</span> <span class="o">=</span> <span class="p">[</span><span class="n">insert_customer_table</span><span class="p">,</span> <span class="n">insert_product_table</span><span class="p">,</span> <span class="n">insert_material_table</span><span class="p">,</span> <span class="n">insert_color_table</span><span class="p">,</span> <span class="n">insert_description_table</span><span class="p">,</span> <span class="n">insert_transactions_table</span><span class="p">]</span></span></span></code></pre></div>
    
</div>
<!-- #endregion -->
<br> 
<br> 
<br> 
<div class="meta-blog-subheader">
3) Create tables
</div>
<br>
<!-- #region create tables script python code -->
<div class="highlight-wrapper">
    <div class="highlight-before">python</div>
    
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">psycopg2</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sql_queries</span> <span class="kn">import</span> <span class="n">create_table_queries</span><span class="p">,</span> <span class="n">drop_table_queries</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">configparser</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ENCODING</span><span class="o">=</span><span class="s1">&#39;utf-16&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">drop_tables</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">conn</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Loops through list of drop table queries
</span></span></span><span class="line"><span class="cl"><span class="s2">    and drops tables listed in sql_queries.py
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">drop_table_queries</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_tables</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">conn</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Loops through list of create table queries
</span></span></span><span class="line"><span class="cl"><span class="s2">    and creates tables listed in sql_queries.py
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">create_table_queries</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Drops and creates tables as outlined in sql_queries.py
</span></span></span><span class="line"><span class="cl"><span class="s2">    You will need the following information in your config.init file:
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    HOST
</span></span></span><span class="line"><span class="cl"><span class="s2">    USER
</span></span></span><span class="line"><span class="cl"><span class="s2">    PASSWORD
</span></span></span><span class="line"><span class="cl"><span class="s2">    DATABASE
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">ENCODING</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">HOST</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jj-furniture&#39;</span><span class="p">,</span><span class="s1">&#39;host&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">USER</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jj-furniture&#39;</span><span class="p">,</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">PASSWORD</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jj-furniture&#39;</span><span class="p">,</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">DATABASE</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jj-furniture&#39;</span><span class="p">,</span><span class="s1">&#39;database&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">HOST</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">USER</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">,</span> <span class="n">dbname</span><span class="o">=</span><span class="n">DATABASE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">        <span class="c1">#drop_tables(cur, conn)</span>
</span></span><span class="line"><span class="cl">        <span class="n">create_tables</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">finally</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></span></span></code></pre></div>
    
</div>
<!-- #endregion -->
<br> 
<br>
<br> 
<div class="meta-blog-subheader">
4) Insert rows of fake data
</div>
<br>
<!-- #region insert rows python code -->
<div class="highlight-wrapper">
    <div class="highlight-before">python</div>
    
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># import</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span> 
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">configparser</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># importing custom modules from upper directories</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mymodule_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">script_dir</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;database&#39;</span><span class="p">,</span> <span class="s1">&#39;table_setup&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">mymodule_dir</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sql_queries</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mymodule_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">script_dir</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;database&#39;</span><span class="p">,</span> <span class="s1">&#39;connection&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">mymodule_dir</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">postgres_db</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># connect to database </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-16&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">config_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">script_dir</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;database&#39;</span><span class="p">,</span> <span class="s1">&#39;connection&#39;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">config_file_path</span> <span class="o">+=</span> <span class="s1">&#39;/config.ini&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">db_conn</span> <span class="o">=</span> <span class="n">postgres_db</span><span class="o">.</span><span class="n">PostgresConnector</span><span class="p">(</span><span class="n">config_file_path</span> <span class="o">=</span> <span class="n">config_file_path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                       <span class="n">section</span> <span class="o">=</span> <span class="s1">&#39;jj-furniture&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                       <span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># insert data: colors</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="s1">&#39;dark grey&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="s1">&#39;beige&#39;</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">color_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">db_conn</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sql_queries</span><span class="o">.</span><span class="n">insert_color_table</span><span class="p">,</span> <span class="p">[</span><span class="n">color</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># insert data: descriptions</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">description_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sofa&#39;</span><span class="p">,</span> <span class="s1">&#39;love-seat&#39;</span><span class="p">,</span> <span class="s1">&#39;dinette set&#39;</span><span class="p">,</span> <span class="s1">&#39;mattress&#39;</span><span class="p">,</span> <span class="s1">&#39;bedframe&#39;</span><span class="p">,</span> <span class="s1">&#39;nightstand&#39;</span><span class="p">,</span> <span class="s1">&#39;chest&#39;</span><span class="p">,</span> <span class="s1">&#39;dresser&#39;</span><span class="p">,</span> <span class="s1">&#39;chair&#39;</span><span class="p">,</span> <span class="s1">&#39;desk&#39;</span><span class="p">,</span> <span class="s1">&#39;desk chair&#39;</span><span class="p">,</span> <span class="s1">&#39;bookcase&#39;</span><span class="p">,</span> <span class="s1">&#39;coffee table&#39;</span><span class="p">,</span> <span class="s1">&#39;end table&#39;</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">description_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">db_conn</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sql_queries</span><span class="o">.</span><span class="n">insert_description_table</span><span class="p">,</span> <span class="p">[</span><span class="n">description</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># insert data: materials</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">material_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fabric&#39;</span><span class="p">,</span> <span class="s1">&#39;leather&#39;</span><span class="p">,</span> <span class="s1">&#39;wood&#39;</span><span class="p">,</span> <span class="s1">&#39;metal&#39;</span><span class="p">,</span> <span class="s1">&#39;plastic&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">material</span> <span class="ow">in</span> <span class="n">material_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">db_conn</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sql_queries</span><span class="o">.</span><span class="n">insert_material_table</span><span class="p">,</span> <span class="p">[</span><span class="n">material</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># insert data: products</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_ids</span><span class="p">(</span><span class="n">table_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    select </span><span class="si">{}</span><span class="s1">_id
</span></span></span><span class="line"><span class="cl"><span class="s1">    from </span><span class="si">{}</span><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">results</span> <span class="o">=</span> <span class="n">db_conn</span><span class="o">.</span><span class="n">queryall</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">table_name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">material_ids</span> <span class="o">=</span> <span class="n">get_ids</span><span class="p">(</span><span class="s1">&#39;materials&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">color_ids</span> <span class="o">=</span> <span class="n">get_ids</span><span class="p">(</span><span class="s1">&#39;colors&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">description_ids</span> <span class="o">=</span> <span class="n">get_ids</span><span class="p">(</span><span class="s1">&#39;descriptions&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">products</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;material_id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">material_ids</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;color_id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">color_ids</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;description_id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">description_ids</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;pieces&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;cost&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># make sure to give same cost to manufacturer </span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df_products</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_products</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">db_conn</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sql_queries</span><span class="o">.</span><span class="n">insert_product_table</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;material_id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;color_id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;description_id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;pieces&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># insert data: customers</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">store_type</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Store&#39;</span><span class="p">,</span> <span class="s1">&#39;Web&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">num_customers</span> <span class="o">=</span> <span class="mi">10000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">customers</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;first_name&#39;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;last_name&#39;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">last_name</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;email_address&#39;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">email</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;dob&#39;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">date_between</span><span class="p">(</span><span class="n">start_date</span> <span class="o">=</span><span class="s1">&#39;-70y&#39;</span><span class="p">,</span> <span class="n">end_date</span> <span class="o">=</span> <span class="s1">&#39;-18y&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">profile</span><span class="p">()[</span><span class="s1">&#39;sex&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;street_address&#39;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">street_address</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">random_element</span><span class="p">(</span><span class="n">elements</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;NC&#39;</span><span class="p">,</span> <span class="s1">&#39;SC&#39;</span><span class="p">,</span> <span class="s1">&#39;TN&#39;</span><span class="p">,</span> <span class="s1">&#39;FL&#39;</span><span class="p">,</span> <span class="s1">&#39;GA&#39;</span><span class="p">,</span> <span class="s1">&#39;MS&#39;</span><span class="p">,</span> <span class="s1">&#39;AL&#39;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;date_created&#39;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">date_between</span><span class="p">(</span><span class="n">start_date</span> <span class="o">=</span><span class="s1">&#39;-12y&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">     <span class="s1">&#39;create_source&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">store_type</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.8</span><span class="p">,</span> <span class="mf">.2</span><span class="p">])</span> <span class="c1"># can give probability of selection to Store Type</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_customers</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df_customers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">customers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_customers</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">num_customers</span><span class="o">*</span><span class="mf">.25</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">db_conn</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sql_queries</span><span class="o">.</span><span class="n">insert_customer_table</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                        <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;last_name&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;email_address&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;dob&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;street_address&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;date_created&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;create_source&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                  <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># insert data: transactions</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_cost</span><span class="p">(</span><span class="n">product</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    select cost
</span></span></span><span class="line"><span class="cl"><span class="s1">    from products
</span></span></span><span class="line"><span class="cl"><span class="s1">    where product_id = </span><span class="si">{}</span><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">db_conn</span><span class="o">.</span><span class="n">queryall</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">product</span><span class="p">))[</span><span class="s1">&#39;cost&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">customer_id_list</span> <span class="o">=</span> <span class="n">get_ids</span><span class="p">(</span><span class="s1">&#39;customers&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">product_id_list</span> <span class="o">=</span> <span class="n">get_ids</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">num_trans</span> <span class="o">=</span> <span class="mi">25000</span>
</span></span><span class="line"><span class="cl"><span class="n">transaction_id</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">years</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2023</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">trans</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trans</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">transaction_id</span> <span class="o">%</span> <span class="n">num_trans</span><span class="o">*</span><span class="mf">.25</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">num_items</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">weights</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">transaction_date</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">date_between_dates</span><span class="p">(</span><span class="n">date_start</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">date_end</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-12-31&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">customer_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">customer_id_list</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_items</span><span class="p">):</span> 
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">product_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">product_id_list</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">line_item_number</span> <span class="o">=</span> <span class="n">item</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="n">sale_or_return</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">sale_amount</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">get_cost</span><span class="p">(</span><span class="n">product_id</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="mf">1.43</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">quantity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.8</span><span class="p">,</span> <span class="mf">.15</span><span class="p">,</span> <span class="mf">.05</span><span class="p">])</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">db_conn</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sql_queries</span><span class="o">.</span><span class="n">insert_transactions_table</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="p">(</span><span class="n">transaction_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">transaction_date</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">customer_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">product_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">line_item_number</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">sale_amount</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">quantity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                          <span class="n">sale_or_return</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                          
</span></span><span class="line"><span class="cl">    <span class="n">transaction_id</span> <span class="o">+=</span> <span class="mi">1</span>                         </span></span></code></pre></div>
    
</div>
<!-- #endregion -->
<!-- #endregion -->
<br> 
<br>
<br> 
<!-- #region Results -->
<div class="meta-blog-header">
Results <a name="result"></a>
</div>
<br>
<!-- #endregion -->
<div class="figure">
<p><img src="https://julian-swart.github.io/images/db_connection.png" alt=""></p>
<p class="caption">DBeaver database connection to our Amazon RDS </a></p>
</div>
<br>
<br>
<br>
<br>
<div class="figure">
<p><img src="https://julian-swart.github.io/images/db_query.png" alt=""></p>
<p class="caption">Image showing the OLTP tables and some results of our fake customer dataset</a></p>
</div>
<br> 
<br>
<br> 
<br>
<!-- #region What was Learned -->
<div class="meta-blog-header">
What was Learned <a name="learned"></a>
</div>
<br>
<ul>
<li>what an RDS is</li>
<li>how to set up an RDS in AWS with postgres</li>
<li>connecting using DBeaver sql client</li>
<li>better github practices (it is not straightforward, I don&rsquo;t care what you say)</li>
<li>olap vs oltp</li>
<li>wrtiting python scripts for automating table creation and inserting rows</li>
</ul>
<br>
<p>Things we didn&rsquo;t do but know need to happen:</p>
<ul>
<li>automating data quality checks</li>
<li>slow-changing dimensions</li>
<li>design fact and dimension tables (ETL)</li>
<li>data security</li>
<li>group permissions</li>
<li>privacy data omissions</li>
</ul>
<br>
<p>This was a fun project and I feel more in-tune with the challenges data engineers face. Mainly, what it takes to architect a data managment solution that is efficient, secure, and makes end-users happy. It should be said that we are aware real-world data is a lot messier and larger than the watered-down example we used here.</p>
<!-- #endregion -->



                </div>

                
            </div>
        </div>
    </div>
</div>

<section id="comments">
    <div class="py-3 content">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-sm-12 col-lg-8">
                    <div class="comments">
                        <script src="https://utteranc.es/client.js" repo=""
                            issue-term="pathname" label="comment" theme="github-light" crossorigin="anonymous" async>
                            </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<br>
<br>
<br>
<br>


<small><center>Website built with Hugo • Theme is a variation of Tanka • Hosted on Github Pages • Custom domain name from GoDaddy.com</center></small>

<br>


    

    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/sql.min.js" defer></script>
        
        <script>
            window.addEventListener('load', function() {
                hljs.initHighlighting();
            }, true);
        </script>
    

    

    
    
        
<script src="https://julian-swart.github.io/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
</body>

</html>
